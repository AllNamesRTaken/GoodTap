!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.goodtap={})}(this,function(t){"use strict";class e{}e.ROTATION_DEGREE_PRECISION=1,e.RADIAN_FACTOR=1/360*(2*Math.PI),e.DEGREE_FACTOR=1/(2*Math.PI)*360,e.DEG360=360*e.ROTATION_DEGREE_PRECISION,e.ROTATION_LOOKUP=function(){const t=[];for(let n=0;n<360*e.ROTATION_DEGREE_PRECISION;n++)t.push([Math.cos(n*e.RADIAN_FACTOR),Math.sin(n*e.RADIAN_FACTOR)]);return t}();class n{}n.EPSILON=1e-8,n.IDENTITY={x:1,y:1},n.X_DIM={x:1,y:0},n.Y_DIM={x:0,y:1};class i{constructor(t=0,e=0){this.angle=this.horizontalAngle,this.direction=this.horizontalAngle,this.x=t,this.y=e}get isZero(){return 0===this.x&&0===this.y}create(t=0,e=0){return new this.constructor(t,e)}set(t){return this.x=t.x,this.y=t.y,this}clone(t){return t?t.set(this):this.create(this.x,this.y)}toInt(){return this.x|=0,this.y|=0,this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}toDecimal(){return this.x+=n.EPSILON,this.y+=n.EPSILON,this}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.lengthSq())}horizontalAngle(){return Math.atan2(this.y,this.x)}rotate(t){const n=function(t){const n=t*e.DEGREE_FACTOR*e.ROTATION_DEGREE_PRECISION|0;return this.rotationDeg(n/e.ROTATION_DEGREE_PRECISION)}(t),i=this.x*n[0]-this.y*n[1],r=this.x*n[1]+this.y*n[0];return this.x=i,this.y=r,this}rotateAround(t,e){return this.subtract(t).rotate(e).add(t)}normalize(){const t=this.length();return 0===t?(this.x=1,this.y=0):(this.x=this.x/t,this.y=this.y/t),this}scale(t){return this.x=this.x*t.x,this.y=this.y*t.y,this}relate(t){return this.x=this.x/t.x,this.y=this.y/t.y,this}multiply(t){return this.x=this.x*t,this.y=this.y*t,this}add(t){return this.x=this.x+t.x,this.y=this.y+t.y,this}subtract(t){return this.x=this.x-t.x,this.y=this.y-t.y,this}invert(){return this.x=-this.x,this.y=-this.y,this}equals(t){return this.x===t.x&&this.y===t.y}almostEquals(t){return Math.abs(this.x-t.x)<n.EPSILON&&Math.abs(this.y-t.y)<n.EPSILON}getNormal(t){const e=this.clone();t||e.set(this).normalize();const n=e.x;return e.x=e.y,e.y=-n,e}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}projectOnto(t){const e=(this.x*t.x+this.y*t.y)/(t.x*t.x+t.y*t.y);return this.x=e*t.x,this.y=e*t.y,this}verticalAngle(){return Math.atan2(this.x,this.y)}rotateBy(t){const e=-this.horizontalAngle()+t;return this.rotate(e)}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}zero(){return this.x=0,this.y=0,this}}let r=!0;var s;"undefined"==typeof window?(s=null,r=!1):s=window;let h=new class{constructor(){this._window=s,this._nativeWindow=r}get window(){return this._window}set window(t){this._window=t,this.hasNativeWindow&&(s=t)}get hasNativeWindow(){return this._nativeWindow}};function l(t){return Array.isArray?Array.isArray(t):"[object Array]"===Object.prototype.toString.call(t)}function o(t){return"[object Function]"===Object.prototype.toString.call(t)}function a(t){return void 0===t||null===t}function u(t){return void 0===t}function c(t){return!u(t)}function d(t,e){return function(...t){return!function(...t){const e=t.length;let n,i=-1,r=!1;for(;!r&&++i<e;)r=void 0===(n=t[i])||null===n;return r}(...t)}(t,e)&&t.constructor===e.constructor}function f(t){let e;if(t instanceof Object)if(void 0!==t.constructor.prototype.clone)e=t.clone();else if(l(t))e=m(t);else{if(t instanceof Date)return new Date(t.getTime());if(t instanceof RegExp)return new RegExp(t);{e=new t.constructor;const n=Object.keys(t);let i=null,r=-1;const s=n.length;for(;++r<s;)e[i=n[r]]=f(t[i])}}else e=t;return e}function p(t,e,n){const i=Object.keys(e);let r,s,h=-1;const l=i.length;for(;++h<l;)s=e[r=i[h]],n&&r in n&&(r=n[r]),r in t&&(t[r]=e[i[h]])}function _(t,e=0,n=1/0){let i=Math.min(a(t)?0:t.length-e,n);i<0&&(i=0);let r=-1;const s=new Array(i);for(;++r<i;)s[r]=t[r+e];return s}function y(t,e){let n,i=a(t)?0:t.length;if(e>=0&&e<i){let r=e;for(n=t[e];++r<i;)t[r-1]=t[r];t.length-=1}return n}function x(t,e){let n=-1;const i=a(t)?0:t.length;for(;++n<i;)if(t[n]===e)return n;return-1}function g(t,e){let n=-1;const i=a(t)?0:t.length;for(;++n<i;)if(e(t[n]))return n;return-1}function v(t){let e=-1;const n=a(t)?0:t.length,i=new Array(n);for(;++e<n;)i[e]=t[e];return i}function m(t){let e=-1;const n=a(t)?0:t.length,i=new Array(n);for(;++e<n;)i[e]=f(t[e]);return i}function w(t,e){let n=-1;const i=a(t)?0:t.length;for(e.length=i;++n<i;)e[n]=f(t[n])}function E(t,e){const n=[];let i=-1;const r=a(t)?0:t.length;for(;++i<r;){const r=t[i];!0===e(r,i)&&n.push(r)}return n}function I(t,e){let n=-1;const i=a(t)?0:t.length,r=new Array(i);for(;++n<i;)r[n]=e(t[n],n);return r}function A(t,e,n){let i=-1;const r=a(t)?0:t.length;for(e.length=r;++i<r;)e[i]=n(t[i],i)}function b(t,e,n=0){let i=n-1;const r=a(t)?0:t.length;for(;++i<r;)e(t[i],i)}function O(t,e,n,i){let r=u(n)||(s=n)===+s;var s;let h=u(i=r?n:i)||i<0?-1:i-1;const l=a(t)?0:t.length;for(;++h<l&&(r?!e(t[h],h):!e(t[h],h)&&(n(t[h],h),1)););}function P(t,e){(t||-1)<0&&(t=0);let n=new Array(t),i=-1;for(;++i<t;)n[i]=e(i,n);return n}function R(t,e,...n){let[i,...r]=n;return c(i)?c(i.prototype.deserialize)?A(t,e,t=>(new i).deserialize(t,...r)):A(t,e,t=>{let e=new i;return p(e,t),e}):w(t,e),this}class T{constructor(){this._lookup=Object.create(null),this._list=new D,this._isDirty=!1}create(){return new this.constructor}has(t){return void 0!==this._lookup[t]}contains(t){return this.has(t)}get(t){return this._lookup[t]}set(t,e){return this._isDirty=this._isDirty||this.has(t),void 0!==e&&(this._lookup[t]=e,this._isDirty||this._list.push(e)),this}delete(t){return this.has(t)&&(delete this._lookup[t],this._isDirty=!0),this}clear(){return function(t){const e=Object.keys(t);let n=-1;const i=e.length;for(;++n<i;)delete t[e[n]]}(this._lookup),this._list.clear(),this}get values(){return this.cleanList(),this._list.values}get keys(){return Object.keys(this._lookup)}get list(){return this.cleanList(),this._list}get count(){let t=0;return t=this._isDirty?this.keys.length:this._list.count}cleanList(){this._isDirty&&this.reCreateList()}reCreateList(){let t=this._lookup,e=Object.keys(this._lookup),n=-1,i=this._list;for(i.clear();++n<e.length;)i.add(t[e[n]])}clone(){let t=this.create();return t._isDirty=this._isDirty,t._list=this._list.clone(),t._lookup=f(this._lookup),t}toJSON(){return this._lookup}serialize(){let t=Object.create(null);return b(this.keys,e=>{let n=this.get(e);t[e]=o(n.serialize)?n.serialize():n}),t}deserialize(t,...e){let[n,...i]=e;if(this.clear(),c(n))if(c(n.prototype.deserialize))for(let e of Object.keys(t))this.set(e,(new n).deserialize(t[e],...i));else for(let e of Object.keys(t)){let i=new n;p(i,t[e]),this.set(e,i)}else for(let e of Object.keys(t))this.set(e,t[e]);return this}}class D{constructor(t){this._array=[],this._index=null,this._indexer=null,this._array=void 0===t?new Array:v(t instanceof D?t._array:t)}create(t){return new this.constructor(t)}get values(){return this._array}get(t){return this._array[t]}getByIndex(t){return a(this._index)?void 0:this._index.get(t)}set(t,e){if(!(t>=0&&t<this.length))throw new Error(`index out of bounds on <List>.set(${t}, ${e.toString()})`);return this._array[0|t]=e,null!==this._indexer&&this._index.set(this._indexer(e),e),this}get count(){return this._array.length}get length(){return this._array.length}get indexer(){return this._indexer}set indexer(t){this._indexer=t,this._reindex()}_reindex(){null===this._indexer?this._index=null:(null===this._index?this._index=new T:this._index.clear(),this.forEach(t=>this._index.set(this._indexer(t),t)))}fill(t,e){return t=Math.max(0,t||0),o(e)?this._array=P(t,e):e instanceof Object?this._array=P(t,()=>f(e)):this._array=P(t,()=>e),this._reindex(),this}clear(){return this._array.length=0,null!==this._index&&this._index.clear(),this}add(t){return this._array.push(t),null!==this._indexer&&this._index.set(this._indexer(t),t),this}insertAt(t,e){return function(t,e,n){if(a(t))throw new Error("Unable to insertAt on null or undefined");if(0===e)t.unshift(n);else if(e>0){let i=t.length;for(;--i>=e;)t[i+1]=t[i];t[i+1]=n}}(this._array,t,e),null!==this._indexer&&this._index.set(this._indexer(e),e),this}push(t){return null!==this._indexer&&this._index.set(this._indexer(t),t),this._array.push(t)}pop(){let t=this._array.pop();return void 0!==t&&null!==this._indexer&&this._index.delete(this._indexer(t)),t}shift(){let t=this._array.shift();return void 0!==t&&null!==this._indexer&&this._index.delete(this._indexer(t)),t}concat(t){let e,n=t instanceof D?t.values:t;return e=function(...t){return Array.prototype.concat.apply([],t)}(this._array,n),this.create(e)}index(t){null!==this._indexer&&b(t,t=>{this._index.set(this._indexer(t),t)})}unindexEl(t){null!==this._indexer&&this._index.delete(this._indexer(t))}append(t){let e=t instanceof D?t.values:t;return function(t,e){let n=-1;const i=t.length,r=a(e)?0:e.length;for(;++n<r;)t[i+n]=e[n]}(this._array,e),this.index(e),this}copy(t){let e=t instanceof D?t.values:t;return w(e,this._array),this.index(e),this}shallowCopy(t){let e=t instanceof D?t.values:t;return function(t,e){let n=-1;const i=a(t)?0:t.length;for(e.length=i;++n<i;)e[n]=t[n]}(e,this._array),this.index(e),this}clone(){const t=m(this._array);let e=this.create(t);return null!==this._indexer&&(e._indexer=this._indexer,e._index=this._index.clone()),e}remove(t){var e;return y(e=this._array,x(e,t)),this.unindexEl(t),this}removeFirst(t){let e=this.removeAt(this.indexOf(t));return this.unindexEl(e),e}removeAt(t){let e=y(this._array,t);return this.unindexEl(e),e}forEach(t,e=0){return b(this._array,t,e),this}forSome(t,e){return function(t,e,n){let i=-1;const r=a(t)?0:t.length;for(;++i<r;){const r=t[i];e(r,i)&&n(r,i)}}(this._array,t,e),this}until(t,e,n){return O(this._array,t,e,n),this}reverseForEach(t){return function(t,e){let n=a(t)?0:t.length;for(;--n>=0;)e(t[n],n)}(this._array,t),this}reverseUntil(t,e){return function(t,e,n){let i=a(t)?0:t.length,r=u(n);for(;--i>=0&&(r?!e(t[i],i):!e(t[i],i)&&(n(t[i],i),1)););}(this._array,t,e),this}some(t){return function(t,e){let n=!1,i=-1;const r=a(t)?0:t.length;for(;++i<r&&!(n=e(t[i])););return n}(this._array,t)}all(t){return function(t,e){let n=!0,i=-1;const r=a(t)?0:t.length;for(;++i<r&&(n=e(t[i])););return n}(this._array,t)}indexOf(t){let e=-1;return e=o(t)?g(this._array,t):x(this._array,t)}contains(t){let e=!1;return e=o(t)?void 0!==this.find(t):null!==this._indexer?this._index.contains(this._indexer(t)):-1!==x(this._array,t)}reverse(){return function(t){let e=null,n=null;const i=a(t)?0:t.length;for(e=0;e<i/2;e+=1){n=i-1-e;const r=t[e];t[e]=t[n],t[n]=r}}(this._array),this}first(t){let e=-1;return-1===(e=void 0===t?0:g(this._array,t))?void 0:this.get(e)}find(t){return this.first(t)}last(){return 0===this.length?void 0:this.get(this.length-1)}filter(t){return this.create(E(this._array,t))}select(t){return this.create(E(this._array,t))}selectInto(t,e){let n=t instanceof D?t.values:t;return function(t,e,n){let i=-1,r=0;const s=a(t)?0:t.length,h=e.length;for(;++i<s;){const s=t[i];!0===n(s,i)&&(r<h?e[r++]=s:(++r,e.push(s)))}e.length=r}(n,this._array,e),this.index(n),this}head(t=1){return t=Math.max(0,t),this.create(_(this._array,0,t))}tail(t=1){return t=Math.min(this._array.length,t),this.create(_(this._array,Math.max(0,this._array.length-t)))}splice(t=0,e=1/0,n=[]){return function(t,e=0,n=1/0,i=[]){if(a(t))throw new Error("Unable to splice on null or undefined");let r=t.length;e=Math.max(0,e),e=Math.min(e,r),n=Math.max(0,n),n=Math.min(n,r-e);let s=i.length,h=r-n+s,l=n-s;if(l<0){t.length=h;let i=h;for(;--i>=e+n;)t[i]=t[i+l]}let o=e-1;for(;++o<e+s;)t[o]=i[o-e];if(l>0){for(--o;++o<r-l;)t[o]=t[o+l];t.length=h}}(this._array,t,e,l(n)?n:n.values),this._reindex(),this}orderBy(t){return this._array.sort(t),this}map(t){return this.create(I(this._array,t))}mapInto(t,e){return A(t instanceof D?t.values:t,this._array,e),this._reindex(),this}reduce(t,e){return function(t,e,n){let i=-1;const r=a(t)?0:t.length;let s=n;for(;++i<r;)s=e(s,t[i]);return s}(this._array,t,e)}reduceUntil(t,e,n){return function(t,e,n,i){let r=-1;const s=a(t)?0:t.length;let h=i;for(;++r<s&&!n(h,t[r]);)h=e(h,t[r]);return h}(this._array,t,e,n)}reverseReduce(t,e){return function(t,e,n){let i=a(t)?0:t.length,r=n;for(;--i>=0;)r=e(r,t[i]);return r}(this._array,t,e)}reverseReduceUntil(t,e,n){return function(t,e,n,i){let r=a(t)?0:t.length,s=i;for(;--r>=0&&!n(s,t[r]);)s=e(s,t[r]);return s}(this._array,t,e,n)}equals(t){return function t(e,n){let i=e===n;if(e!==n&&e instanceof Object&&d(e,n))if(l(e)){const r=e.length;let s=0;if(i=r===n.length)for(;s<r&&!1!==(i=t(e[s],n[s]));s+=1);}else if(e.constructor.prototype.equals)i=e.equals(n);else{const r=Object.keys(e);let s=null;i=!0;let h=-1;const l=r.length;for(;++h<l;)if(!(i=t(e[s=r[h]],n[s]))){if(!o(e[s]))break;i=!0}}return i}(this._array,t.values)}same(t){let e=this,n=0;return e.length===t.length&&(null!==e.indexer?t.until(t=>!e.contains(t),(t,e)=>++n):e.until(e=>!t.contains(e),(t,e)=>++n)),n===e.length}intersect(t){let e,n,i=this.create();return i.indexer=this.indexer,this.length<t.length?(n=this,e=t):(e=this,n=t),null!==e.indexer?n.forEach(t=>{e.contains(t)&&i.push(t)}):e.forEach(t=>{n.contains(t)&&i.push(t)}),i}union(t){let e,n,i=this.create();return i.indexer=this.indexer,this.length<t.length?(n=this,e=t):(e=this,n=t),null!==e.indexer?(i=e.clone(),n.forEach(t=>{e.contains(t)||i.push(t)})):(i=n.clone(),e.forEach(t=>{n.contains(t)||i.push(t)})),i}subtract(t){let e=this.create();return e.indexer=this.indexer,e=this.select(e=>!t.contains(e))}zip(t,e=((t,e)=>[t,e])){let n=this.create(),i=t.length;return this.until(function(t,e){return e>=i},function(i,r){n.push(e(i,t.get(r)))}),n}unzip(t=(t=>[t[0],t[1]])){let e=[this.create(),this.create()];return this.forEach(function(n){let i=t(n);e[0].push(i[0]),e[1].push(i[1])}),e}flatten(t=1/0){return this.create(t<1?this.values:this._flattenInner(this.values,t))}_flattenInner(t,e,n=-1,i=[]){let r=-1;const s=t.length;if(++n>e)i.push(t);else for(;++r<s;)l(t[r])?this._flattenInner(t[r],e,n,i):t[r]instanceof D?this._flattenInner(t[r].values,e,n,i):i.push(t[r]);return i}toJSON(){return this.values}serialize(){return this.values.map(t=>o(t.serialize)?t.serialize():t)}deserialize(t,...e){return R(t,this._array,...e),this}}class S{}S._hasPerformance="undefined"!=typeof performance;class M{static get time(){return S._time}static now(){if(S._hasPerformance)return performance.now();{const t=process.hrtime();return 1e3*t[0]+t[1]/1e6}}static start(){const t=M.now();return S._start=S._last=t,S._time=0}static stop(){const t=S._start,e=M.now();return S._last=e,S._time=e-t}}function L(){let t=(new Date).getTime();return t+=M.now(),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const n=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"===e?n:3&n|8).toString(16)})}let N=j=class{constructor(){this.id="",this.parent=null,this.children=null,this.data=null,this.virtual=!1,this.id=L()}static fromObject(t){const e=this instanceof j?this:null,n=(new j).init({id:t.id||L(),data:t.data,parent:e});return void 0!==t.children&&l(t.children)&&(n.children=new D(I(t.children,j.fromObject.bind(n)))),n}static fromNodeList(t,e,n=!1){let i=new j,r=t=>e&&void 0!==e[t]?"string"==typeof e[t]?n=>n[e[t]]:e[t]:e=>e[t],s={id:r("id"),parent:r("parent"),data:r("data")},h=new D(t),l=new T;h.forEach((t,e)=>{let n=(new j).init({id:s.id(t),data:s.data(t)});l.set(n.id,n)});let o=new D;return h.forEach((t,e)=>{let n=s.parent(t);l.contains(n)?l.get(n).add(l.get(s.id(t))):o.add(l.get(s.id(t)))}),!1===n?i=o.first():(i=(new j).init({id:L(),virtual:!0}),o.forEach(t=>i.add(t))),i}create(){return new this.constructor}init(t){return p(this,t),this}insertAt(t,e){null===this.children||this.children.count<=t?this.add(e):this.children.insertAt(t,this.create().init({data:e,parent:this}))}add(t){null===this.children&&(this.children=new D),d(t,this)?(t.parent=this,this.children.add(t)):this.children.add(this.create().init({data:t,parent:this}))}remove(){null!==this.parent&&this.parent.children.remove(this)}prune(){return null!==this.children&&this.children.forEach(function(t,e){t.parent=null}).clear(),this.children=null,this}reduce(t,e){const n=new class{constructor(t){this.DEFAULT_SIZE=100,this._pos=0,this._limit=0,t||(t=this.DEFAULT_SIZE),this.DEFAULT_SIZE=t,this._array=new Array(t),this.push=this.fastPush}get values(){return _(this._array,0,this._pos)}get depth(){return this._pos}get size(){return this._pos}get isEmpty(){return 0===this.size}get limit(){return this._limit}set limit(t){t<0&&(t=0),this._limit=t,0===t?this.push=this.fastPush:(this.push=this.limitedPush,this.limitObjects())}create(t){return new this.constructor(t)}push(t){}fastPush(t){this._array[this._pos++]=t}limitedPush(t){this._array[this._pos]=t,++this._pos,this.limitObjects()}pop(){let t=void 0;return 0!==this._pos&&(t=this._array[--this._pos]),t}peek(){return this._array[this._pos-1]}peekAt(t){return t<0||t>=this._pos?void 0:this._array[this._pos-t-1]}toList(){return new D,new D(this.values)}clear(){return this._pos=0,this._array.length=this.DEFAULT_SIZE,this}clone(){const t=m(this._array);let e=this.create(this.DEFAULT_SIZE);return e._array=t,e._limit=this._limit,e._pos=this._pos,e}limitObjects(){for(;this._pos>this._limit;)this._array.shift(),--this._pos}toJSON(){return _(this.values,0,this._pos)}serialize(){return _(this.values,0,this._pos).map(t=>o(t.serialize)?t.serialize():t)}deserialize(t,...e){return R(t,this._array,...e),this._pos=t.length,this}};let i,r,s=e;for(t||(t=((t,e)=>(t.push({id:e.id,parent:e.parent?e.parent.id:null,data:e.data}),t))),void 0===e&&(s=[]),n.push(this);i=n.pop();)for(s=t(s,i),r=i.children&&i.children.count||0;r--;)n.push(i.children.get(r));return s}clone(){const t=new this.constructor;return t.id=this.id,t.parent=this.parent,t.children=null===this.children?null:this.children.clone(),t.data=null===this.data||void 0===this.data?this.data:f(this.data),t}duplicateNode(){const t=new this.constructor;return t.id=this.id,t.parent=this.parent,t.children=this.children,t.data=this.data,t}filter(t){const e=this.duplicateNode();return null!==this.children&&(e.children=e.children.select(t).map(function(e,n){return e.filter(t)})),e}select(t,e=new D){const n=e,i=this.children;return(void 0===t||t(this))&&n.add(this),i&&i.reduce(function(e,n){return n.select(t,e)},n),n}find(t){let e=null;if(null!==this.children){let n=-1;const i=this.children.count,r=this.children.values;for(;++n<i;){if(t(r[n].data)){e=r[n];break}if(null!==(e=null!==r[n].children?r[n].find(t):null))break}}return e}contains(t){return null!==this.find(t)}depth(){let t=0,e=this;for(;e.parent;)e=e.parent,++t;return t}toJSON(){let t=new D;return t.push({id:this.id,data:this.data,parent:null===this.parent?null:this.parent.id,children:null===this.children?null:this.children.map(t=>t.id)}),null!==this.children&&this.children.forEach(e=>t.append(e.toJSON())),t.toJSON()}serialize(){let t=new D;return t.push({id:this.id,data:this.data,parent:null===this.parent?null:this.parent.id,children:null===this.children?null:this.children.map(t=>t.id)}),null!==this.children&&this.children.forEach(e=>t.append(e.serialize())),t.serialize()}};var j,k,z;N=j=function(t,e,n,i){var r,s=arguments.length,h=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)h=Reflect.decorate(t,e,n,i);else for(var l=t.length-1;l>=0;l--)(r=t[l])&&(h=(s<3?r(h):s>3?r(e,n,h):r(e,n))||h);return s>3&&h&&Object.defineProperty(e,n,h),h}([function(t){return class extends t{init(t,e){return p(this,t,e),this}}},function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}("design:paramtypes",[])],N),function(t){t[t.Top=0]="Top",t[t.Bottom=1]="Bottom",t[t.Left=2]="Left",t[t.Right=3]="Right"}(k||(k={}));class F{}function C(t){return Array.prototype.slice.call(t)}function q(t,e){let n=!1;if(e.matches)n=e.matches(t);else if(e.msMatchesSelector)n=e.msMatchesSelector(t);else if(e.webkitMatchesSelector)n=e.webkitMatchesSelector(t);else{if(null===e.parentElement)throw new Error("Element has no parent");n=""!==e.id?null!==e.parentElement.querySelector("#"+e.id):-1!==C(e.parentElement.querySelectorAll(t)).indexOf(e)}return n}F.Sides=k,F._window=h.window,F._document=h.window?h.window.document:void 0,F._el=h.window?h.window.document.createElement("div"):void 0,function(t){t[t.LinearInt=0]="LinearInt",t[t.RandomInt=1]="RandomInt",t[t.LinearFloat=2]="LinearFloat",t[t.RandomFloat=3]="RandomFloat"}(z||(z={}));class U{constructor(t){this.minSwipeDistance=100,this.events=["down","up","press","tap","swipe"],this.downEvents=["down"],this.upEvents=["up","tap","swipe"],this.longPressIntervals=new T,this.eventAttr="",this.upEventsAndPress=[],this.index=0,this.init(t||document.body),this.eventAttr=this.events.map(t=>"["+t+"]").join(","),this.upEventsAndPress=[...this.upEvents,"press"]}init(t){U.hasTouchEvent()&&(t.addEventListener("touchInfo",t=>{this.begin(t)}),t.addEventListener("touchend",t=>{this.end(t)})),t.addEventListener("mousedown",t=>{this.begin(t)}),t.addEventListener("mouseup",t=>{this.end(t)})}findTarget(t){let e=null;for(;t&&t.parentElement!==document&&null===e;)q(this.eventAttr,t)&&(e=t),t=t.parentElement;return e}getTouchPos(t){let e=new i(0,0);return t instanceof TouchEvent?e=new i(t.changedTouches[0].pageX,t.changedTouches[0].pageY):t instanceof MouseEvent&&(e=new i(t.pageX,t.pageY)),e}longPress(t,e){let n=!0,i=e.touchInfo;(!1===(n=this.executeAction(t,e,"press",i))||e.hasAttribute("once"))&&(clearInterval(this.longPressIntervals.get(i.index)),this.longPressIntervals.delete(i.index))}begin(t){this.longPressIntervals.list.forEach(t=>clearInterval(t)),this.longPressIntervals.clear();let e=!1,n=t.target,i=0;for(;i<100&&(n=this.findTarget(n))&&!e;){++i;let r=null;n.hasAttribute("press")&&(r=setInterval((e=>this.longPress(t,e)).bind(this,n),parseInt(n.getAttribute("pressInterval"))||500)),n.classList.add("gt-active"),n.touchInfo={index:this.index++,time:M.now(),pos:this.getTouchPos(t),long:r},r&&this.longPressIntervals.set(n.touchInfo.index,n.touchInfo.long),O(this.downEvents,i=>(n.hasAttribute(i)&&(!(e=!1===this.handleEvent(i,t,n))&&n.hasAttribute("stopPropagation")&&(e=!0,t.stopPropagation()),n.hasAttribute("preventDefault")&&t.preventDefault()),e)),n=n.parentElement}}isSwipe(t,e){let n=this.getTouchPos(t),r=!1;if("touchInfo"in e){let t=n.x-e.touchInfo.pos.x,s=n.y-e.touchInfo.pos.y,h=Math.abs(t),l=Math.abs(s),o=h>l,a=o?h:l;(r=a>=this.minSwipeDistance)&&(e.touchInfo.swipeInfo={direction:o?t<0?"left":"right":s<0?"up":"down",distance:a,delta:new i(t,s)})}return r}end(t){M.now();let e=!1,n=t.target,i=0;for(;i<100&&(n=this.findTarget(n))&&!e;){++i;let r=n.touchInfo;void 0===r&&this.longPressIntervals.has(r.index)?(n.classList.remove("gt-active"),clearInterval(this.longPressIntervals.get(r.index)),delete n.touchInfo):O(this.upEventsAndPress,i=>{if(n.hasAttribute(i)){let r=this.isSwipe(t,n);("swipe"===i&&r||"tap"===i&&!r||"up"===i)&&(e=!1===this.handleEvent(i,t,n)),(e||n.hasAttribute("stopPropagation"))&&(e=!0,t.stopPropagation(),delete n.touchInfo),n.hasAttribute("preventDefault")&&t.preventDefault()}return e}),n=n.parentElement}var r,s;(r=".gt-active",C((s||F._document).querySelectorAll(r))).forEach(t=>{t.classList.remove("gt-active"),delete t.touchInfo}),this.longPressIntervals.list.forEach(t=>clearInterval(t)),this.longPressIntervals.clear()}executeAction(t,e,n,i){let r=!0,s=e.getAttribute(n);try{r="[fn]"===s&&n+"-fn"in e?e[n+"-fn"](t,e,i):new Function("event","target","touch",s).bind(e)(t,e,i)}catch(t){throw name+" event function error on element '"+e.id+"'"}return r}handleEvent(t,e,n){let i=t,r=!0;return n&&(r=this.executeAction(e,n,i,n.touchInfo),t in this.upEvents&&(n.classList.remove("gt-active"),this.longPressIntervals.has(n.touchInfo.index)&&clearInterval(this.longPressIntervals.get(n.touchInfo.index)),delete n.touchInfo)),r}on(t,e,n){t.setAttribute(e,"[fn]"),t[e+"-fn"]=n}off(t,e){t.removeAttribute(e+"-action"),delete t[e+"-fn"]}static hideKeyboard(){let t=document.createElement("input");t.setAttribute("type","text"),document.body.appendChild(t),setTimeout(function(){t.focus(),setTimeout(function(){t.setAttribute("style","display:none;"),t.parentElement.removeChild(t)},50)},50)}static hasTouchEvent(){return"ontouchInfo"in document.documentElement}}t.GoodTap=U,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=goodtap.es6.umd.min.js.map
